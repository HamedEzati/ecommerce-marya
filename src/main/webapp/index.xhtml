<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui" xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
>

<h:head>

</h:head>
<style>
    html{
             scroll-behavior: smooth;
         }
    a{
        text-decoration: none;
        color: black;
        scroll-behavior: smooth;
    }
   #catStyle{
       display: flex;
       align-items: center;
       justify-content: center;
   }
   #catStyle>li{
       position: relative;
       padding: 30px;
       list-style-type:none;
       text-decoration: none;
       background-color: rgba(97,96,96,0.3);
       border-radius: 5px;
       margin: 20px;
       text-align: justify;
    /*color: black;*/
       box-shadow: 5px 10px rgba(99,99,99,0.1);
   }
   #catStyle>li:hover  #subCat{
      display: block;
   }
   #subCat{
       top:80px;
       display: none;
       position: absolute;
       background-color: rgba(97,96,96,0.5);
       list-style-type: none;
       border-radius: 5px;
       padding: 10px;
       text-decoration: none;
       color: black;
   }
   #subCat > a {
       border-bottom: 1px solid gray;
       text-decoration: none;
       color: black;
   }
   #nav{
       background-color: #f8f9fa;
       box-shadow: 5px 10px 10px rgba(99,99,99,0.1);
       border: 0.2px solid darkgray;
       border-radius: 6px;
   }
   #navUl{
       display: flex;

   }
   #navUl>li{
       padding: 10px;
       list-style-type: none;
   }
   #navUl>li:hover{
       background-color: rgba(92,92,92,0.2);
       border-radius: 5px;

   }
   #logo{
       width: 160px;
       height: 70px;
       float: right;
       box-shadow:5px 10px 10px rgba(99,99,99,0.1);
   }
   #logo>img{
       width: 100%;
       height:97%;
       border-radius: 10px;
   }

.product{
        border: 1px solid darkgray;
        border-radius: 10px;
        margin: 13px;

}
    .product-name{
        display: block;
        /*float: right*/
        margin-bottom: 5px;
    ;
    }

    #detailProduct>img{
        border-radius: 20px;
    }
    #detailProduct>*{
        display: inline;
        /*float: right;*/
        justify-content: center;
        align-items: center;
        text-align: center;
        line-break: auto;

    }
    .product-description{
        line-break: auto;
        opacity: 0.4;
        margin-bottom: 5px;
        padding: 10px;
    }
    .product-description:hover{

        opacity: 1;
    }
    .product-price{
        padding: 10px;
    }
    #detailProduct> button{
        display: inline;
        /*float: right;*/
        justify-content: center;
        align-items: center;
        text-align: center;
    }
    #priceDetail>*{
        text-align: center;
        display: block;
        line-break: auto;
    }
    #productImge{
        border-radius: 20px;
    }
    #addButton{
        width: 100%;
        border-radius: 0px 0px 10px 10px;
        background-color: #4CAF50; /* Green */
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        font-size: 16px;
    }
    #addButton:hover{
        background-color: #1c7430; /* Green */
        cursor: pointer;
    }
    #disabledButton{
        width: 100%;
        border-radius: 0px 0px 10px 10px;
        background-color: #af0a00;
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        font-size: 16px;
    }
    #addButton:active{
        background-color: #1c7430;
    }
    .ui-carousel .ui-carousel-viewport .ui-carousel-items .ui-carousel-item{
        width: 329px!important;
    }
    .ui-widget-header{
        background-color: #4e555b!important;
        background: none;
        border-color: #4e555b;
        border:2px;
    }
    .cat-Name-H2{
       box-shadow: 0px 0px 30px 2px darkgrey;
        width: 20%;
        padding: 15px;
        text-align: center;
        border-radius: 5px;
        font-size: 22px;
        margin-left: 100px;
        justify-content: center;
        align-items: center;
        display: flex;
    }
    .cat-Name-H2>*{
        box-shadow: 0px 0px 30px 2px darkgrey;
        width: 20%;
        padding: 10px;
        text-align: center;
        border-radius: 5px;
        font-size: 22px;
        margin-left: 100px;
        justify-content: center;
        align-items: center;
        display: flex;
    }

    .cart{
        width: 30px;
        font-size: 15px;
        margin-left:10px;
        border-radius: 5px;
    }
    #logout-nav:hover{
        cursor: pointer;
    }

</style>
<h:body>
    <nav id="nav">

        <div id ='logo'>
            <h:graphicImage library="images" name="logo.jpeg" />

        </div>
        <ul id = 'navUl'>
            <li>
                <a href="index.xhtml"> Home</a>
            </li>
            <li>
                <a href="#.xhtml"> about Us</a>
            </li>
            <li id="login-nav">
                <a href="login.xhtml"> Login</a>
            </li>
            <li id="category-nav">
                <a href="category.xhtml"> manage cetegories</a>
            </li>
            <li id="product-nav">
                <a href="product.xhtml"> manage products</a>
            </li>
            <li id="logout-nav">
                <a onclick="logout()"> Logout</a>
            </li>

            <li style="border: 1px solid darkolivegreen; border-radius: 5px">
                <a href="cart.xhtml">
                    cart
                    <div class="cart" style="float: right; border: 1px solid darkred; border-radius: 150px; background: firebrick; color: white;  padding-left: 10px" >
                        cart
                    </div>
                </a>


            </li>
        </ul>
    </nav>
    <div id ='slider'>
        <div>
        </div>
        <div>
            <h:graphicImage style="width: 100% ; height: 400px" library="images" name="3.png" />
        </div>

    </div>
    <ul id="catStyle">
        <ui:repeat value="#{categoryPublicController.parents}" var="category">
            <li>
                <h:link value="#{category.name}" fragment ="#{category.name}" />
<!--                    <f:param name="id" value="#{category.id}"/>-->
<!--                </h:link>-->
                <ul id ="subCat">
                    <ui:repeat value="#{category.subcategories}" var="subCategory1Id"
                               rendered="#{not empty category.subcategories}">
                        <li>
                            <c:set var="subCategory1" value="#{categoryPublicController.get(subCategory1Id)}"/>
                            <h:link style="text-decoration: none" value=" #{subCategory1.name}`" fragment ="#{subCategory1.name}" />
                        </li>
                    </ui:repeat>
                </ul>
            </li>
        </ui:repeat>
    </ul>


    <ui:repeat value="#{categoryPublicController.all}" var="category">
            <h4 class="cat-Name-H2" id="#{category.name}">#{category.name}</h4>
            <p:carousel value="#{productPublicController.getAllByCategoryId(category.id)}" var="product" responsive="true" >
                <div class="product">
                    <div  id ='detailProduct' class="product-grid-item p-p-5">
                        <div  class="product-grid-item-top">
                            <div>
                                <i class=" product-category-icon"/>
                                <span class="product-category">#{productCategory.name}</span>
                            </div>
                        </div>
                        <div class="product-grid-item-content">
                            <p id = 'productImge' class="image"><img src="${product.imageUrl}" alt="" style="width: 100%"/></p>
                            <div class="product-name">#{product.name}</div>
                            <div>quantity: #{product.quantity}</div>
                        </div>
                        <div>
                            <div class="product-description">#{product.description}</div>
                        </div>
                        <div id = 'priceDetail' class="product-grid-item-bottom">
                            <h:outputText value="#{product.price}" styleClass="product-price">
                                <f:convertNumber currencySymbol="Price :$" type="currency"/>
                            </h:outputText>
                            <div>
                                <h:panelGroup rendered="#{product.quantity > 0}">
                                    <button class="btn" id="addButton" style="text-align: center" type="button" onclick="addProductToCard(#{product.toString})" >add</button>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{product.quantity le 0}">
                                    <button class="btn" id="disabledButton" style="text-align: center" type="button" >not exists</button>
                                </h:panelGroup>
                            </div>


                        </div>
                    </div>
                </div>
            </p:carousel>
    </ui:repeat>

</h:body>
<script>
    isAuth = localStorage.getItem("auth");
    console.log(isAuth)
    if (isAuth == null || isAuth == "false"){
        document.getElementById("category-nav").style.display = "none";
        document.getElementById("login-nav").style.display = "list-item";
        document.getElementById("logout-nav").style.display = "none";
        document.getElementById("product-nav").style.display = "none";
    }else {
        document.getElementById("category-nav").style.display = "list-item";
        document.getElementById("login-nav").style.display = "none";
        document.getElementById("logout-nav").style.display = "list-item";
        document.getElementById("product-nav").style.display = "list-item";
    }


    function logout() {
        localStorage.removeItem("auth");
        location.reload();
    }
function myFunction(){
    location.reload()
}
     function addProductToCard(product){
         cart = JSON.parse(localStorage.getItem("cart") || "[]");
         let quantity = 0;
         cart.forEach(productInCart => {
             if (product.id == productInCart.id){
                 quantity++;
             }
         })
         if (product.quantity &lt;= quantity){
             alert("not exists more from this product");
             return;
         }
        window.location.reload()
         cart.push(product);
         localStorage.setItem("cart", JSON.stringify(cart));

     }
let cart =  JSON.parse(localStorage.getItem("cart") || "[]");

let cartDiv = document.querySelector(".cart");
cartDiv.innerHTML = cart.length;
$('button').click(function(i,curent){
    $('cartDiv').html(curent)
})

</script>
<script src="https://code.jquery.com/jquery-3.5.0.js"></script>
</html>